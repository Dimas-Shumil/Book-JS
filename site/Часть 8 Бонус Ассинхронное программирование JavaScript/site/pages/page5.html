<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/sass.css">
    <title>Бонус. Асинхронное программирование JS</title>
</head>

<body>
    <header class="header">
        <nav class="header__nav">

            <div class="header__nav-title">
                5. SetTimeout. SetInterval.
            </div>

            <ul class="header__nav-ul">
                <li><a href="../../index.html"><span class="header__nav-ul_link"></span></a></li>
                <li><a href="page2.html"><span class="header__nav-ul_link"></span></a></li>
                <li><a href="page2.html"><span class="header__nav-ul_link"></span></a></li>
                <li><a href="page4.html"><span class="header__nav-ul_link"></span></a></li>
                <li><a href="#"><span class="header__nav-ul_link"></span></a></li>
                <li><a href="page6.html"><span class="header__nav-ul_link"></span></a></li>
                <li><a href="page7.html"><span class="header__nav-ul_link"></span></a></li>
                <li><a href="page8.html"><span class="header__nav-ul_link"></span></a></li>
                <li><a href="page9.html"><span class="header__nav-ul_link"></span></a></li>
            </ul>
        </nav>
    </header>
    <hr class="hr">
    </div>

    <div class="main">
        <div class="main__wrapper">
            <div id="mySidenav" class="sidenav">
                <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
                <a href="#" target="_blank"> Часть 1 Введение в JavScript</a>
                <a href="#">Часть 2 Введение в JavaScript</a>
                <a href="#">Часть 3 Введение в JavaScript</a>
                <a href="#">Часть 4 Функции JavaScript</a>
                <a href="#">часть 5 Функции и объекты JavaScript</a>
                <a href="#">часть 6 JavaScript Объекты</a>
                <a href="#">Часть 7 JavaScript DOM</a>
                <a href="#">Часть 8 Бонус Ассинхронное программирование JavaScript</a>
                <a href="#">Часть 9 Бонус DOM</a>
                <a href="#">Часть 10 AJAX</a>
                <a href="#">Часть 12 Тестирование JS</a>
                <a href="#">Часть11 API браузера</a>
            </div>
            <span class="sidenav__btn" onclick="openNav()">&#9776;</span>
            <!-- <span class="sidenav__btn" style="font-size:30px;cursor:pointer; border: 1px solid grey;" onclick="openNav()">&#9776; Открыть</span> -->

            <div class="main__wrapper-conteiner">

                <p>Мы уже не раз упоминали setTimeout, но делали это поверхностно. Пора погрузиться в тему и понять, как
                    работают setTimeout и его коллега setInterval. И научиться их применять в своём коде. Начинаем.</p>
                <p>Как мы уже упоминали, setTimeout — не часть самого JS. Выполнение этой функции берёт на себя
                    браузерный API. С setInterval то же самое.</p>
                <p>Когда цикл событий видит, что перед ним кто-то из этой парочки, он отдаёт их браузеру, а сам
                    продолжает заниматься своими делами.</p>

                <h2>SetTimeout()</h2>

                <p>Несмотря на то, что мы уже наблюдали за работой таймаута и успели немного изучить его поведение,
                    давайте дадим ему определение:</p>
                <h3>SetTimeout — это функция, которая запускает код через некоторое время. В первом аргументе вы
                    указываете функцию, которую хотите выполнить. Во втором — время задержки (в миллисекундах). Ваша
                    функция выполнится однократно.</h3>
                <p>Напишем какой-нибудь интересный пример на основе таймаута и посмотрим на его работу:</p>

                <iframe src="../frame/frame5/frame5-1.html" width="90%" height="500px" frameborder="0"></iframe>

                <p>Итак, мы создали анимацию шарика, который катается из стороны в сторону. Мы добились этого благодаря
                    рекурсивному запуску таймаута.</p>
                <div class="main__wrapper-box_blue">
                    <p>Рекурсия — это когда, например, функция запускает саму себя. В примере мы запускаем animate в
                        теле самой animate, с некоторыми задержками. Поэтому шарик и двигается.</p>
                </div>
                <p>Итак, какой синтаксис у таймера:</p>
                <div class="main__wrapper-box_grey">
                    <p> setTimeout(коллбэк, задержка) </p>
                </div>
                <p>Всё довольно просто.</p>
                <hr class="hr">
            </div>

            <h2>Упражнение 5.1.</h2>

            <p><b>Заполните пропуски в создании таймаута. Сделайте задержку в 2 секунды.</b></p>
            <div class="main__wrapper-box_grey">
                <p>set 1._____(2.___ => {</p>
                <blockquote>console.log('Мне нужен таймаут!')</blockquote>
                <p>}, 3.______)</p>
            </div>
            <p>1.</p>
            <blockquote>Timeout</blockquote>
            <p>2.</p>
            <blockquote>()</blockquote>
            <p>3.</p>
            <blockquote>2000</blockquote>
            <hr class="hr">

            <div class="main__wrapper-conteiner">
                <p>Бывают ситуации, когда у нас много данных. Например, большая галерея фотографий или большая таблица.
                    Если отрисовывать её разом, то опять упрёмся в замороженную страницу, о которой уже говорили.</p>
                <p>Да что тут объяснять? Вы же наверняка сами не раз сидели и ждали, пока страница прогрузится и можно
                    будет нажать хоть какую-то кнопку. Или хотя бы закрыть страницу.</p>
                <p>Смоделируем такую ситуацию в коде:</p>

                <iframe src="../frame/frame5/frame5-2.html" width="90%" height="500px" frameborder="0"></iframe>

                <p>Здесь вы можете нажать на кнопку и отрисовать много картинок. Очень много картинок. Попробуйте это
                    сделать. А потом нажмите на вторую кнопку.</p>
                <p>Только не тыкайте интенсивно на все-все кнопки много раз. Иначе страшилки про замороженную страницу
                    станут явью.</p>
                <p>Функционал кнопки — вывод строчки в консоль. Но вряд ли она туда выведется сразу. Поскольку браузер
                    занят отрисовкой наших картинок. Параллельные задачи не выполняются, пока все картинки не попадут в
                    разметку.</p>
                <p>Так себе, конечно, история. Что делать? Можно воспользоваться неочевидным способом. А именно —
                    setTimeout, в который мы передадим нулевую задержку. То есть — число 0.</p>
                <p>Такая задержка говорит setTimeout-у дождаться, пока стек вызовов окажется пустым, и только потом
                    отдавать коллбэк. Этот коллбэк оказывается самым последним в очереди. Очередная несправедливость.
                </p>
                <p>Что это даст: мы разобьём сложную задачу на несколько кусков проще. Разделим все картинки на
                    несколько частей. И будем вставлять их постепенно.</p>
                <p>Благодаря этому мы сможем получать строку о параллельной задаче в консоль не через очень много
                    времени, а в промежутках между этими операциями.</p>
                <p>В примере мы используем просто вывод в консоль. Конечно, в реальной работе вам не нужны такие вещи.
                    Но что вам точно нужно знать, так это то, как не дать пользователю покинуть сайт раньше времени. Как
                    позволить ему нажимать на кнопку, пока на фоне работают долгие операции.</p>
                <p>Давайте поправим наш пример:</p>

                <iframe src="../frame/frame5/frame5-3.html" width="90%" height="500px" frameborder="0"></iframe>
                <p>Теперь мы вставляем картинки в документ не разом, а по чуть-чуть. Нажимайте на кнопку параллельно
                    задачи — вы увидите, что всё работает.</p>
                <hr class="hr">

                <h2>Упражнение 5.2.</h2>

                <p>Напишите таймаут, который будет отсчитывать в консоли с 10 до нуля и начинаться заново.</p>
                <details>
                    <summary>Посмотреть код</summary>
                    <div class="main__wrapper-box_grey">
                        <p>const timeout = (sec = 10) => {</p>
                        <blockquote>if (sec >= 0) {</blockquote>
                        <blockquote>
                            <blockquote>console.log(sec);</blockquote>
                            <blockquote>setTimeout(() => {</blockquote>
                            <blockquote>
                                <blockquote>timeout(sec - 1);</blockquote>
                            </blockquote>
                            <blockquote>}, 1000);</blockquote>
                        </blockquote>
                        <blockquote>} else {</blockquote>
                        <blockquote>
                            <blockquote>console.log("Время вышло!");</blockquote>
                            <blockquote>timeout();</blockquote>
                        </blockquote>
                        <p>};</p>
                        <p>timeout();</p>
                    </div>
                </details>
                <hr class="hr">

                <h2>SetInterval()</h2>

                <p>С этим инструментом вы ещё не знакомы. Это поправимо. Он похож на setTimeout, но имеет свои тонкости.
                    Итак, определение:</p>
                <h3>setInterval — функция, которая выполняет код через определённый интервал времени. Она повторяется,
                    пока вы её не остановите. Первым аргументом принимает функцию, а вторым — время интервала. После
                    запуска интервала второй аргумент уже не меняется.</h3>
                <p>С помощью этого инструмента можно создавать логику, где нужно периодически обновлять какие-то данные.
                </p>
                <p>Но мы создадим простой таймер обратного отсчёта до Нового Года:</p>

                <iframe src="../frame/frame5/frame5-4.html" width="90%" height="500px" frameborder="0"></iframe>

                <p>Благодаря setInterval мы запускаем каждую секунду подсчёт точного времени. На каждом шаге наша
                    функция высчитывает текущее время, делает расчёт дней, часов, минут и секунд.</p>
                <p>Давайте обсудим немного, почему вычисления выглядят именно так:</p>
                <blockquote>1. Для начала мы вычисляем сегодняшнюю дату. И делаем это с помощью инструмента Date().
                </blockquote>
                <blockquote>2. Затем мы берём из сегодняшней даты год и задаём конечную точку отсчёта: 31 декабря
                    нынешнего года.</blockquote>
                <blockquote>3. Далее мы запускаем интервал. На каждой итерации узнаём текущее время в миллисекундах.
                </blockquote>
                <blockquote>4. Затем вычитаем его из конечной даты в миллисекундах.</blockquote>
                <blockquote>5. Используем полученную разницу, чтобы вычислить дни, часы, минуты и секунды:</blockquote>
                <blockquote>
                    <blockquote>&bull; Первым делом ищем количество дней. Для этого миллисекунды разницы делим на
                        миллисекунды в одном дне.</blockquote>
                    <blockquote>&bull; Затем ищем часы. Чтобы понять, сколько часов не вошло в дни, а осталось, сначала
                        используем оператор %. Ведь у нас наверняка получилось не ровное количество дней — сколько-то
                        миллисекунд остались лишними. Поэтому их мы делим на количество миллисекунд в одном часе. И
                        получаем часы.</blockquote>
                    <blockquote>&bull; То же самое, только теперь ищем остаток от часов. А потом делим на количество
                        миллисекунд в минуте.</blockquote>
                    <blockquote>&bull; И, наконец, находим количество секунд. Логика та же. Ищем то, что не вошло в
                        минуты, а потом делим на 1000 миллисекунд.</blockquote>
                    <blockquote>&bull; Не забываем округлять результаты до целого числа в меньшую сторону. В этом
                        поможет инструмент Math.floor().</blockquote>
                </blockquote>
                <blockquote>6. Вставляем полученные переменные в код с помощью шаблонной строки.</blockquote>
                <blockquote>7. Проверяем, не истекло ли время. Если истекло, очищаем интервал. И предупреждаем
                    пользователя.</blockquote>
                <p>Заметили неопознанный объект? Что за clearInterval? Давайте поговорим об этом.</p>

                <h2>clearTimeout, clearInterval</h2>

                <p>Здорово, что мы можем задавать таймауты и интервалы. Иногда это полезно. Таймаут выполняется один
                    раз, если не помещён в рекурсию, и не составляет большой проблемы.</p>
                <p>А вот интервал может существовать долго. Но что если он нам уже не нужен? Надо научиться его удалять.
                </p>
                <p>Фишка в том, что если присвоить таймаут или интервал в какую-то переменную, то в ней окажется
                    идентификатор. И по нему как раз можно очистить таймаут/интервал.</p>
                <p>Давайте посмотрим:</p>

                <iframe src="../frame/frame5/frame5-5.html" width="90%" height="300px" frameborder="0"></iframe>

                <p>Интервал запускается сразу, но если вы нажмёте на кнопку, то он остановится. И больше отрабатывать не
                    будет. Очень удобно. :)</p>
                <p>Очередной юнит пройден. В этот раз мы подробно остановились на методах setTimeout и setInterval.
                    Научились применять их в работе, создавать анимации с помощью таймера и очищать интервалы. Так
                    держать! До встречи в следующем юните. :)</p>

                <h2>Упражнение 5.3.</h2>

                <p>Создайте интервал, который будет выводить в консоль числа. Начинать с 0 и каждый раз прибавлять
                    единицу. Также напишите логику обнуления интервала, если число становится больше 50.</p>
                <details>
                    <summary>Посмотреть код</summary>
                    <div class="main__wrapper-box_grey">
                        <p>function interval(count = 0) {</p>
                        <blockquote>const intervalId = setInterval(() => {</blockquote>
                        <blockquote>
                            <blockquote>if (count > 50) {</blockquote>
                            <blockquote>
                                <blockquote>console.log("Отсчёт окончен!");</blockquote>
                                <blockquote>clearInterval(intervalId);</blockquote>
                                <blockquote>return;</blockquote>
                            </blockquote>
                            <blockquote>}</blockquote>
                            <blockquote>console.log(count);</blockquote>
                            <blockquote>count++;</blockquote>
                        </blockquote>
                        <blockquote>}, 1000);</blockquote>
                        <p>}</p>
                        <p>interval();</p>
                    </div>
                </details>
                <hr class="hr">

                <h2>Упражнение 5.4.</h2>

                <blockquote>Напишите секундомер с функцией обнуления, если прошло больше минуты.</blockquote>
                <hr class="hr">

                <h2>Упражнение 5.5.</h2>

                <blockquote>Задача со звёздочкой. Если есть желание и навыки, создайте анимацию с помощью setTimeout по
                    аналогии с примером из юнита. Поменяйте её визуал, цвета и размеры. Можете сделать её не
                    горизонтальной, а вертикальной.</blockquote>
            </div>
            <!-- кнопки -->
            <div class="main__btn-box">
                <a href="page4.html" class="previous">&laquo; Назад</a>
                <a href="page6.html" class="next">Вперед &raquo;</a>
            </div>
            <div class="main__btn-box-o">
                <a href="page4.html" class="previous round">&#8249;</a>
                <a href="page6.html" class="next round">&#8250;</a>
            </div>
        </div>

        <button onclick="topFunction()" id="myBtn" title="Перейти к началу">вверх</button>

        <script async src="../script/js.js"></script>

        <!-- &lsaquo;&rsaquo;&lsaquo;/&rsaquo;
             &lsaquo;script&rsaquo;&lsaquo;/script&rsaquo; -->
        <!-- <details>
            <summary>Заголовок</summary>
            Здесь располагается скрытый контент, который будет отображен после клика по заголовку.
        </details>
    </div>
</body>

</html>